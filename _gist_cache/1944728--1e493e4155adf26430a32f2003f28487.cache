beforeEach ->
  @root = Lead.state_chart.get('rootState')
  @notParsing = Lead.state_chart.getState('notParsing')
  @parsing = Lead.state_chart.getState('parsing')

describe 'StateCharts', ->
  describe 'rootState', ->
    it 'should have an initial substate',->
      expect(@root.get('initialSubstate')).toEqual(@notParsing)

    it 'should transition to parsing state', ->
      spyOn(Lead.parsing_controller, 'start_parsing')
      Ember.run.end()
      Lead.state_chart.sendAction('startParsing', {search_url: "http://thesoftwaresimpleton.com/"})
      expect(@parsing.get('isCurrentState')).toBeTruthy()
      expect(Lead.parsing_controller.get('isParsing')).toBeTruthy()
      expect(Lead.parsing_controller.start_parsing).toHaveBeenCalled()

afterEach ->
  Lead.state_chart.destroy()
  Lead.state_chart = null
